# Claude Web 测试指南

## 功能测试：AskUserQuestion（用户问题询问）

### 测试目的
验证 Claude 能够主动询问用户并在对话界面显示选择选项。

### 测试步骤

#### 1. 访问页面
打开浏览器访问: http://your-server-ip:5000

#### 2. 测试场景：Git Push 确认

在聊天框输入：
```
请帮我将所有更改推送到 GitHub 的 claude-web 仓库
```

#### 3. 预期行为

**Claude 应该：**
1. 检查当前 git 状态
2. 看到有未推送的提交
3. **主动调用 `ask_user_question` 工具询问你**
4. 在聊天界面显示一个**蓝色问题卡片**，包含：
   - 问题标题（如 "Git Push"）
   - 问题内容（如 "是否要将更改推送到远程仓库？"）
   - 选项按钮：
     - "是的，立即推送" - 将所有提交推送到 GitHub
     - "不，稍后再推" - 暂时不推送，保留在本地
     - "其他" - 自定义输入
   - "提交答案" 按钮

**你应该：**
1. 看到蓝色问题卡片（不是黄色权限审批框）
2. 选择一个选项
3. 点击"提交答案"按钮
4. 看到答案已提交的确认
5. Claude 根据你的选择继续执行或取消操作

#### 4. 验证点

✅ **正确的行为：**
- 问题卡片是蓝色背景（`#e3f2fd`）
- 有清晰的选项按钮
- 点击提交后，卡片变为绿色"已提交答案"状态
- Claude 收到答案后继续对话
- 如果选择"是"，执行 `git push`
- 如果选择"否"，取消操作

❌ **错误的行为：**
- 显示黄色权限审批框（这是旧的系统审批）
- 页面卡住不响应
- 没有显示问题卡片
- 点击提交后没有反应

### 测试场景 2：其他需要确认的操作

可以测试的其他场景：
```
请帮我删除所有 .pyc 文件
请帮我重置到上一个提交
请帮我合并 dev 分支到 main
```

Claude 应该在执行这些潜在危险操作前主动询问确认。

## 调试技巧

### 1. 查看浏览器控制台
按 F12 打开开发者工具，查看 Console 标签：
- 应该看到 `Tool result received:` 日志
- 应该看到 `Showing user questions:` 日志
- 检查是否有 JavaScript 错误

### 2. 查看网络请求
在开发者工具的 Network 标签：
- 找到 `/api/chat` 请求
- 查看 Response，应该包含 `tool_result` 事件
- 检查 `requires_user_input: true` 和 `questions` 数据

### 3. 查看服务器日志
```bash
tail -f /root/claude-web/app.log
```

## 当前配置

- **自动权限审批**: 已禁用
- **Claude 主动询问**: 已启用
- **问题显示位置**: 聊天对话界面
- **答案提交方式**: 作为新的用户消息发送

## 已知问题

无

## 成功标准

- ✅ Claude 能主动调用 `ask_user_question` 工具
- ✅ 问题卡片正确显示在对话中
- ✅ 用户可以选择选项并提交
- ✅ 答案正确传回 Claude
- ✅ Claude 根据答案继续执行
- ✅ 整个流程不卡住

## 下一步

如果测试通过，可以推送代码到 GitHub：
```bash
git push origin main
```
